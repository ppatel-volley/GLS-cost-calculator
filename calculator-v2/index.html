<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CoComelon Infrastructure Cost Calculator</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Oxygen', 'Ubuntu', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            line-height: 1.6;
            color: #2c3e50;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 16px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.12);
            overflow: visible;
            backdrop-filter: blur(10px);
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 40px 30px;
            text-align: center;
            border-radius: 16px 16px 0 0;
            position: relative;
        }

        .header::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #ff6b6b, #4ecdc4, #45b7d1);
        }

        .header h1 {
            font-size: 2.6rem;
            margin-bottom: 12px;
            font-weight: 700;
            text-shadow: 0 2px 4px rgba(0,0,0,0.1);
            letter-spacing: -0.02em;
        }

        .header p {
            font-size: 1.2rem;
            opacity: 0.95;
            font-weight: 300;
            max-width: 600px;
            margin: 0 auto;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0;
        }

        .config-panel {
            background: linear-gradient(180deg, #f8f9fb 0%, #f1f3f7 100%);
            padding: 32px;
            border-right: 1px solid #e2e8f0;
            max-height: 80vh;
            overflow-y: auto;
        }

        .results-panel {
            padding: 32px;
            max-height: 80vh;
            overflow-y: auto;
            background: #ffffff;
        }

        .section {
            margin-bottom: 30px;
        }

        .section h3 {
            color: #2d3436;
            margin-bottom: 18px;
            font-size: 1.35rem;
            font-weight: 600;
            border-bottom: 3px solid #667eea;
            padding-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .section-description {
            background: linear-gradient(135deg, #e8f4fd 0%, #f0f8ff 100%);
            padding: 18px;
            border-radius: 8px;
            margin-bottom: 24px;
            border-left: 4px solid #667eea;
            font-size: 0.92rem;
            color: #1e3a8a;
            line-height: 1.6;
            box-shadow: 0 2px 8px rgba(102, 126, 234, 0.1);
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            font-weight: 500;
            margin-bottom: 5px;
            color: #2d3436;
            font-size: 0.9rem;
        }

        .label-with-tooltip {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .tooltip {
            position: relative;
            display: inline-block;
            cursor: help;
        }

        .tooltip .tooltiptext {
            visibility: hidden;
            width: 300px;
            background-color: #333;
            color: #fff;
            text-align: left;
            border-radius: 6px;
            padding: 10px;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            margin-left: -150px;
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 12px;
            line-height: 1.4;
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
        }

        .tooltip:hover .tooltiptext {
            visibility: visible;
            opacity: 1;
        }

        .tooltip-icon {
            background: #2196f3;
            color: white;
            border-radius: 50%;
            width: 16px;
            height: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 11px;
            font-weight: bold;
        }

        .results-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 20px;
        }

        .cost-analysis-tooltip .tooltip-icon {
            background: #ffc107;
            color: #333;
            width: 24px;
            height: 24px;
            font-size: 12px;
            margin: 0;
        }

        .cost-analysis-text {
            width: 400px !important;
            background-color: #333;
            border-left: 4px solid #ffc107;
            font-size: 11px;
            line-height: 1.4;
            white-space: pre-line;
        }

        .cost-analysis-tooltip:hover .cost-analysis-text {
            visibility: visible;
            opacity: 1;
        }

        .revenue-analysis {
            border-left: 4px solid #28a745 !important;
            background: linear-gradient(135deg, #d4edda 0%, #f0fff4 100%);
        }

        .revenue-analysis h4 {
            color: #155724;
        }

        .form-group input, .form-group select {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 14px;
            transition: all 0.3s ease;
            background: #ffffff;
            font-weight: 500;
        }

        .form-group input:focus, .form-group select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.15);
            transform: translateY(-1px);
        }

        .hourly-pattern {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: 8px;
            margin-top: 10px;
        }

        .hour-block {
            text-align: center;
        }

        .hour-label {
            font-size: 10px;
            font-weight: 600;
            margin-bottom: 4px;
            color: #666;
            line-height: 1.2;
        }

        .hour-label.peak {
            color: #d32f2f;
            background: #ffebee;
            padding: 2px 4px;
            border-radius: 3px;
        }

        .hour-label.off-peak {
            color: #1976d2;
            background: #e3f2fd;
            padding: 2px 4px;
            border-radius: 3px;
        }

        .hourly-input {
            width: 100%;
            text-align: center;
            padding: 6px 4px;
            font-size: 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }

        .hourly-input.peak {
            border-color: #f44336;
            background: #fff5f5;
        }

        .hourly-input.off-peak {
            border-color: #2196f3;
            background: #f8fbff;
        }

        .pattern-editor {
            margin-bottom: 24px;
        }

        .pattern-graph {
            width: 100%;
            max-width: 720px;
            height: 240px;
            margin: 0 auto 20px auto;
            background: #ffffff;
            border-radius: 12px;
            box-shadow: inset 0 1px 3px rgba(15, 23, 42, 0.08);
            border: 1px solid rgba(99, 102, 241, 0.25);
            position: relative;
        }

        .pattern-graph svg {
            width: 100%;
            height: 100%;
            touch-action: none;
            border-radius: 12px;
            display: block;
        }

        .pattern-graph .graph-grid-line {
            stroke: rgba(148, 163, 184, 0.35);
            stroke-dasharray: 4;
            stroke-width: 1;
        }

        .pattern-graph .graph-grid-label {
            font-size: 10px;
            fill: #64748b;
            user-select: none;
        }

        .pattern-graph .graph-area {
            fill: rgba(79, 70, 229, 0.12);
            stroke: none;
        }

        .pattern-graph .graph-line {
            fill: none;
            stroke: #4f46e5;
            stroke-width: 2.5;
        }

        .pattern-graph .graph-point {
            fill: #ffffff;
            stroke: #4f46e5;
            stroke-width: 2;
            cursor: pointer;
            transition: stroke-width 0.15s ease, fill 0.15s ease;
        }

        .pattern-graph .graph-point:hover,
        .pattern-graph .graph-point.active {
            fill: #4f46e5;
            stroke-width: 3;
        }

        .pattern-graph .graph-hour-label {
            font-size: 10px;
            fill: #1f2937;
            user-select: none;
        }

        .pattern-graph .graph-tooltip {
            position: absolute;
            padding: 6px 8px;
            background: rgba(17, 24, 39, 0.85);
            color: #f8fafc;
            font-size: 11px;
            border-radius: 4px;
            pointer-events: none;
            transform: translate(-50%, -120%);
            white-space: nowrap;
        }

        .pattern-legend {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin: 15px 0 10px 0;
            font-size: 0.85rem;
        }

        .metric[data-tooltip] {
            position: relative;
        }

        .metric[data-tooltip]:hover::after {
            content: attr(data-tooltip);
            position: absolute;
            left: 0;
            bottom: 110%;
            width: 240px;
            max-width: 260px;
            background: rgba(17, 24, 39, 0.9);
            color: #f8fafc;
            padding: 10px 12px;
            border-radius: 6px;
            font-size: 11px;
            line-height: 1.45;
            box-shadow: 0 10px 25px rgba(15, 23, 42, 0.25);
            white-space: pre-line;
            z-index: 5;
        }

        .metric[data-tooltip]:hover::before {
            content: '';
            position: absolute;
            left: 12px;
            bottom: 100%;
            border-width: 6px;
            border-style: solid;
            border-color: rgba(17, 24, 39, 0.9) transparent transparent transparent;
            z-index: 6;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .legend-color {
            width: 12px;
            height: 12px;
            border-radius: 2px;
        }

        .peak-legend { background: #ffebee; border: 1px solid #f44336; }
        .off-peak-legend { background: #e3f2fd; border: 1px solid #2196f3; }

        .calculate-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 18px 32px;
            font-size: 1.1rem;
            font-weight: 600;
            border-radius: 10px;
            cursor: pointer;
            width: 100%;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .calculate-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
            background: linear-gradient(135deg, #5a6fd8 0%, #6a4c93 100%);
        }

        .calculate-btn:active {
            transform: translateY(0);
        }

        @keyframes flash {
            0% { background: #28a745; }
            50% { background: #20c997; }
            100% { background: #28a745; }
        }

        .results-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .result-card {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }

        .result-card h4 {
            color: #2d3436;
            margin-bottom: 15px;
            font-size: 1.1rem;
        }

        .metric {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            padding: 5px 0;
        }

        .metric-label {
            color: #636e72;
            font-size: 0.9rem;
        }

        .metric-value {
            font-weight: 600;
            color: #2d3436;
        }

        .month-tabs {
            display: flex;
            gap: 5px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .month-tab {
            background: #e9ecef;
            border: none;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.3s;
        }

        .month-tab.active {
            background: #667eea;
            color: white;
        }

        .month-tab:hover {
            background: #495057;
            color: white;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
        }

        .error {
            background: #ffe6e6;
            color: #d63031;
            padding: 15px;
            border-radius: 6px;
            margin: 10px 0;
            border: 1px solid #fab1a0;
        }

        .instance-config {
            background: #fff;
            border: 1px solid #ddd;
            border-radius: 6px;
            padding: 15px;
            margin-bottom: 10px;
        }

        .instance-config h5 {
            margin-bottom: 10px;
            color: #2d3436;
            font-size: 1rem;
        }

        .instance-detail-line {
            font-size: 0.85rem;
            color: #374151;
            margin-bottom: 6px;
        }

        .instance-detail-line strong {
            color: #1f2937;
        }

        .instance-row {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 10px;
            margin-bottom: 10px;
        }

        .cost-highlight {
            background: #e8f5e8;
            padding: 15px;
            border-radius: 6px;
            border-left: 4px solid #4caf50;
            margin-top: 20px;
        }

        .cost-highlight h4 {
            color: #2e7d32;
            margin-bottom: 10px;
            font-size: 1.1rem;
        }

        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
            }

            .hourly-pattern {
                grid-template-columns: repeat(4, 1fr);
            }

            .header h1 {
                font-size: 2rem;
            }
        }

        .chart-container {
            margin-top: 20px;
            background: white;
            border-radius: 8px;
            padding: 20px;
            border: 1px solid #e9ecef;
        }

        .chart-scroll {
            overflow-x: auto;
            padding-bottom: 8px;
            margin-bottom: 10px;
        }

        .chart-scroll-inner {
            display: inline-flex;
            justify-content: center;
            min-width: 900px;
        }

        .chart-scroll::-webkit-scrollbar {
            height: 8px;
        }

        .chart-scroll::-webkit-scrollbar-thumb {
            background: rgba(79, 70, 229, 0.35);
            border-radius: 4px;
        }

        .chart-scroll::-webkit-scrollbar-track {
            background: rgba(226, 232, 240, 0.6);
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🎮 CoComelon Infrastructure Calculator</h1>
            <p>Pure infrastructure cost modeling - configure usage patterns and see real capacity needs</p>
        </div>

        <div class="main-content">
            <!-- Configuration Panel -->
            <div class="config-panel">
                <div class="section">
                    <h3>🎮 Game Mode Selection</h3>
                    <div class="section-description">
                        Choose which games to model: CoComelon only (child-focused streaming) or All Games (adult gaming portfolio excluding CoComelon). Each mode uses real production data and behavior patterns specific to its audience.
                    </div>

                    <div class="form-group">
                        <div class="label-with-tooltip">
                            <label>Game Mode</label>
                            <div class="tooltip">
                                <span class="tooltip-icon">?</span>
                                <span class="tooltiptext">CoComelon Only: Child-focused streaming with 8% concurrent ratio and child behavior patterns (6 PM peak, nap times). All Games: Adult gaming portfolio with 15% concurrent ratio from real production data (4 PM peak, gradual buildup).</span>
                            </div>
                        </div>
                        <select id="game_mode_selector">
                            <option value="cocomelon">🧸 CoComelon Only (Child Streaming)</option>
                            <option value="all_games">🎮 All Games (Adult Gaming)</option>
                        </select>
                    </div>

                    <div id="cocomelon_explanation" style="background: #f8f9ff; padding: 15px; border-radius: 8px; margin-top: 15px; border-left: 4px solid #4a90e2;">
                        <h4 style="margin: 0 0 10px 0; color: #2c5aa0; font-size: 0.95rem;">🧸 CoComelon Model Includes:</h4>
                        <div style="display: grid; grid-template-columns: repeat(1, 1fr); gap: 12px; font-size: 0.85rem;">
                            <div><strong>📅 Child Schedules:</strong> Weekday vs weekend patterns with nap times (1-3 PM) and bedtime routines (6:30-8 PM)</div>
                            <div><strong>🌍 Timezone Awareness:</strong> Local time calculations across US timezones with staggered peak distribution</div>
                            <div><strong>👶 8% Concurrent Ratio:</strong> Reflects realistic toddler attention patterns and scheduled viewing</div>
                            <div><strong>⏰ Peak Time:</strong> 6 PM local (dinner prep time)</div>
                            <div><strong>👨‍👩‍👧 Household Filter:</strong> 10% of users (target-age children in US households)</div>
                        </div>
                    </div>

                    <div id="all_games_explanation" style="background: #fff8f0; padding: 15px; border-radius: 8px; margin-top: 15px; border-left: 4px solid #ff9500; display: none;">
                        <h4 style="margin: 0 0 10px 0; color: #d17000; font-size: 0.95rem;">🎮 All Games Model Includes:</h4>
                        <div style="display: grid; grid-template-columns: repeat(1, 1fr); gap: 12px; font-size: 0.85rem;">
                            <div><strong>📊 Real Production Data:</strong> Hourly patterns from Amplitude analytics (Sept 30 - Oct 7, 2025)</div>
                            <div><strong>🌍 Timezone Awareness:</strong> Same local time calculations across US timezones</div>
                            <div><strong>🎯 15% Concurrent Ratio:</strong> Real data from 4,000 DAU with 612 peak concurrent users</div>
                            <div><strong>⏰ Peak Time:</strong> 4 PM local (afternoon gaming window)</div>
                            <div><strong>👥 No Household Filter:</strong> All users are adult gamers (no child filtering needed)</div>
                        </div>
                    </div>
                </div>

                <div class="section" id="timezone_distribution_section" style="display: none;">
                    <h3>🌍 Timezone Distribution</h3>
                    <div class="section-description">
                        Configure how your users are distributed across US timezones. This affects peak usage patterns since children have different bedtimes and routines based on their local time.
                    </div>

                    <div class="form-group">
                        <div class="label-with-tooltip">
                            <label>Eastern Timezone (EST/EDT)</label>
                            <div class="tooltip">
                                <span class="tooltip-icon">?</span>
                                <span class="tooltiptext">Percentage of users in Eastern timezone (UTC-5). Includes states like NY, FL, GA, NC, SC, VA, etc.</span>
                            </div>
                        </div>
                        <input type="number" id="timezone_eastern" value="0.47" min="0" max="1" step="0.01">
                    </div>

                    <div class="form-group">
                        <div class="label-with-tooltip">
                            <label>Central Timezone (CST/CDT)</label>
                            <div class="tooltip">
                                <span class="tooltip-icon">?</span>
                                <span class="tooltiptext">Percentage of users in Central timezone (UTC-6). Includes states like TX, IL, MO, LA, AL, etc.</span>
                            </div>
                        </div>
                        <input type="number" id="timezone_central" value="0.29" min="0" max="1" step="0.01">
                    </div>

                    <div class="form-group">
                        <div class="label-with-tooltip">
                            <label>Mountain Timezone (MST/MDT)</label>
                            <div class="tooltip">
                                <span class="tooltip-icon">?</span>
                                <span class="tooltiptext">Percentage of users in Mountain timezone (UTC-7). Includes states like CO, UT, AZ, NM, etc.</span>
                            </div>
                        </div>
                        <input type="number" id="timezone_mountain" value="0.07" min="0" max="1" step="0.01">
                    </div>

                    <div class="form-group">
                        <div class="label-with-tooltip">
                            <label>Pacific Timezone (PST/PDT)</label>
                            <div class="tooltip">
                                <span class="tooltip-icon">?</span>
                                <span class="tooltiptext">Percentage of users in Pacific timezone (UTC-8). Includes states like CA, WA, OR, NV, etc.</span>
                            </div>
                        </div>
                        <input type="number" id="timezone_pacific" value="0.17" min="0" max="1" step="0.01">
                    </div>

                    <div class="form-group">
                        <div class="label-with-tooltip">
                            <label>Timezone Total Validation</label>
                            <div class="tooltip">
                                <span class="tooltip-icon">ℹ️</span>
                                <span class="tooltiptext">All timezone percentages should add up to 1.00 (100%). The calculator will show a warning if they don't.</span>
                            </div>
                        </div>
                        <div id="timezone_total_display" style="background: #f0f8ff; padding: 15px; border-radius: 6px; font-size: 0.9em; color: #1e3a8a;">
                            <strong>Current Total:</strong> <span id="timezone_total_value">1.00</span> (100%)
                            <div id="timezone_warning" style="color: #d63031; font-weight: bold; margin-top: 5px; display: none;">
                                ⚠️ Timezone percentages must add up to 1.00 (100%)
                            </div>
                        </div>
                    </div>
                </div>

                <div class="section">
                    <h3>👥 User Base & Growth</h3>
                    <div class="section-description">
                        Configure your current user base and growth projections. These drive how much infrastructure capacity you'll need each month.
                    </div>

                    <div class="form-group">
                        <div class="label-with-tooltip">
                            <label>Starting Daily Active Users (DAU)</label>
                            <div class="tooltip">
                                <span class="tooltip-icon">?</span>
                                <span class="tooltiptext">How many unique users use your service each day at launch. This is your starting point for Month 1 growth calculations.</span>
                            </div>
                        </div>
                        <input type="number" id="current_dau" value="4140" min="0">
                    </div>

                    <div class="form-group" id="generic_concurrent_ratio" style="display: none;">
                        <div class="label-with-tooltip">
                            <label>Peak Concurrent Ratio (Generic Model)</label>
                            <div class="tooltip">
                                <span class="tooltip-icon">?</span>
                                <span class="tooltiptext">What percentage of your daily users are online at the same time during peak hours. Generic model uses fixed ratio regardless of time of day.</span>
                            </div>
                        </div>
                        <input type="number" id="peak_concurrent_ratio" value="0.10" min="0" max="1" step="0.01">
                    </div>

                    <div class="form-group">
                        <div class="label-with-tooltip">
                            <label>Monthly Growth Rate</label>
                            <div class="tooltip">
                                <span class="tooltip-icon">?</span>
                                <span class="tooltiptext">How fast your user base grows each month. 10% = doubles every 7 months, 20% = doubles every 4 months. Growing platforms often see 10-25% monthly growth.</span>
                            </div>
                        </div>
                        <input type="number" id="monthly_growth_rate" value="0.10" min="0" max="1" step="0.01">
                    </div>

                    <div class="form-group">
                        <div class="label-with-tooltip">
                            <label>Household Percentage (Research-Based)</label>
                            <div class="tooltip">
                                <span class="tooltip-icon">?</span>
                                <span class="tooltiptext">Research shows 10% of US households have children in CoComelon target age (1.5-5 years). This filter is ONLY applied to the starting DAU in Month 1 to identify existing CoComelon-interested users. All new marketing users are already CoComelon-targeted.</span>
                            </div>
                        </div>
                        <input type="number" id="household_percentage" value="0.10" min="0" max="1" step="0.01">
                    </div>

                    <div class="form-group">
                        <div class="label-with-tooltip">
                            <label>User Retention Rate</label>
                            <div class="tooltip">
                                <span class="tooltip-icon">?</span>
                                <span class="tooltiptext">Percentage of users who continue using the service each month. 88% means you retain 88% of users from the previous month. Typical retention rates range from 70-95% depending on product engagement.</span>
                            </div>
                        </div>
                        <input type="number" id="user_retention_rate" value="0.88" min="0" max="1" step="0.01">
                    </div>

                    <div class="form-group">
                        <div class="label-with-tooltip">
                            <label>Growth Logic Explanation</label>
                            <div class="tooltip">
                                <span class="tooltip-icon">ℹ️</span>
                                <span class="tooltiptext">How the user calculations work across months.</span>
                            </div>
                        </div>
                        <div style="background: #e8f4f8; padding: 15px; border-radius: 6px; font-size: 0.9em; color: #2c5aa0;">
                            <strong>Month 1:</strong> (Starting DAU × <span id="household_display">10</span>% household filter) + Marketing targets<br>
                            <strong>Month 2+:</strong> (Previous users × <span id="retention_display">88</span>% retention) + New marketing acquisitions<br>
                            <strong>Marketing Control:</strong> Direct monthly acquisition targets - all new users assumed CoComelon users
                        </div>
                    </div>
                </div>

                <div class="section">
                    <h3>📈 Marketing Acquisition (12-Month Plan)</h3>
                    <div class="section-description">
                        Configure your marketing-driven new user acquisition targets for each month. These targets can be adjusted based on marketing budget, campaigns, and market conditions.
                    </div>

                    <div class="form-group">
                        <div class="label-with-tooltip">
                            <label>New User Assumptions</label>
                            <div class="tooltip">
                                <span class="tooltip-icon">ℹ️</span>
                                <span class="tooltiptext">Simplified for capacity planning: All new users are CoComelon users. Marketing inputs direct monthly acquisition numbers.</span>
                            </div>
                        </div>
                        <div style="background: #f0f8ff; padding: 15px; border-radius: 6px; font-size: 0.9em; color: #1e3a8a;">
                            <strong>✅ All new users = CoComelon users</strong> (for capacity planning)<br>
                            <strong>📊 Marketing inputs monthly targets directly</strong> (no complex multipliers)
                        </div>
                    </div>

                    <div class="acquisition-targets">
                        <h4>Monthly New User Targets</h4>
                        <div class="targets-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                            <div class="target-input">
                                <label>Month 1</label>
                                <input type="number" id="target_month_1" value="500" min="0" step="50">
                            </div>
                            <div class="target-input">
                                <label>Month 2</label>
                                <input type="number" id="target_month_2" value="1200" min="0" step="50">
                            </div>
                            <div class="target-input">
                                <label>Month 3</label>
                                <input type="number" id="target_month_3" value="2000" min="0" step="50">
                            </div>
                            <div class="target-input">
                                <label>Month 4</label>
                                <input type="number" id="target_month_4" value="2500" min="0" step="50">
                            </div>
                            <div class="target-input">
                                <label>Month 5</label>
                                <input type="number" id="target_month_5" value="2200" min="0" step="50">
                            </div>
                            <div class="target-input">
                                <label>Month 6</label>
                                <input type="number" id="target_month_6" value="2000" min="0" step="50">
                            </div>
                            <div class="target-input">
                                <label>Month 7</label>
                                <input type="number" id="target_month_7" value="1800" min="0" step="50">
                            </div>
                            <div class="target-input">
                                <label>Month 8</label>
                                <input type="number" id="target_month_8" value="1600" min="0" step="50">
                            </div>
                            <div class="target-input">
                                <label>Month 9</label>
                                <input type="number" id="target_month_9" value="1500" min="0" step="50">
                            </div>
                            <div class="target-input">
                                <label>Month 10</label>
                                <input type="number" id="target_month_10" value="1400" min="0" step="50">
                            </div>
                            <div class="target-input">
                                <label>Month 11</label>
                                <input type="number" id="target_month_11" value="1800" min="0" step="50">
                            </div>
                            <div class="target-input">
                                <label>Month 12</label>
                                <input type="number" id="target_month_12" value="2200" min="0" step="50">
                            </div>
                        </div>
                    </div>
                </div>

                <div class="section">
                    <h3>🕐 Hourly Usage Patterns</h3>
                    <div class="section-description">
                        Configure when your users are most active throughout the day (in Eastern Time). These patterns drive your infrastructure costs since you need more servers during peak hours. Patterns are based on typical children's viewing habits and are automatically adjusted for users in different US timezones.
                        <br><br>
                        <strong>Usage Multipliers:</strong> 1.0 = 100% of peak concurrent users online, 0.5 = 50% online, 0.1 = 10% online
                        <br><br>
                        <strong>Research Basis:</strong> Peak times reflect common childhood routines (nap time, after-school, bedtime) but specific multiplier values should be validated with actual usage data once available.
                    </div>

                    <div class="pattern-legend">
                        <div class="legend-item">
                            <div class="legend-color peak-legend"></div>
                            <span>Peak Hours (high server needs)</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color off-peak-legend"></div>
                            <span>Off-Peak Hours (low server needs)</span>
                        </div>
                    </div>

                    <h5>Weekday Pattern (School Days) - All Times in Eastern Time (EST/EDT)</h5>
                    <div style="font-size: 0.85rem; color: #666; margin-bottom: 15px; padding: 10px; background: #f8f9fa; border-radius: 4px;">
                        <strong>Timezone Reference:</strong> Enter usage multipliers for Eastern Time hours. The calculator automatically converts these to local time for each user's timezone (Eastern 47%, Central 29%, Mountain 7%, Pacific 17%) to create staggered peak distributions.
                    </div>
                    <div class="pattern-editor">
                        <div class="pattern-graph" id="weekday_graph"></div>
                        <div class="hourly-pattern" id="weekday_pattern"></div>
                    </div>

                    <h5 style="margin-top: 20px;">Weekend Pattern (Saturday/Sunday) - All Times in Eastern Time (EST/EDT)</h5>
                    <div style="font-size: 0.85rem; color: #666; margin-bottom: 15px; padding: 10px; background: #f8f9fa; border-radius: 4px;">
                        <strong>Example:</strong> When you set 6 PM EST to 1.0 (peak usage), users in Pacific Time experience this peak at their local 3 PM, creating natural timezone staggering that reduces infrastructure costs.
                    </div>
                    <div class="pattern-editor">
                        <div class="pattern-graph" id="weekend_graph"></div>
                        <div class="hourly-pattern" id="weekend_pattern"></div>
                    </div>
                </div>

                <div class="section">
                    <h3>💻 Server Instance Type</h3>
                    <div class="section-description">
                        Choose your preferred Amazon GameLift Streams class. Existing T4 pricing remains available alongside the new Gen6 NVIDIA L4 stream classes.
                    </div>
                    <div class="form-group">
                        <div class="label-with-tooltip">
                            <label>Instance / Stream Class</label>
                            <div class="tooltip">
                                <span class="tooltip-icon">?</span>
                                <span class="tooltiptext">Switch between the original NVIDIA T4 stream class and new Gen6 NVIDIA L4 stream classes. Pricing defaults to us-east-1 beta rates. Multi-tenant Gen6 options share GPUs for lower cost, while dedicated options provide full GPU access.</span>
                            </div>
                        </div>
                        <select id="instance_type_select"></select>
                    </div>
                    <div id="instance_type_details" class="section-description" style="margin-top: 12px; background: #f8fafc; border-left: 4px solid #4f46e5; font-size: 0.85rem; color: #1f2937;"></div>
                </div>

                <div class="section">
                    <h3>⚙️ Capacity Planning</h3>
                    <div class="section-description">
                        Configure buffer capacity and storage needs to ensure reliable service during unexpected spikes.
                    </div>

                    <div class="form-group">
                        <div class="label-with-tooltip">
                            <label>Peak Buffer Percentage</label>
                            <div class="tooltip">
                                <span class="tooltip-icon">?</span>
                                <span class="tooltiptext">Extra capacity during peak hours to handle unexpected spikes. 15% means if you need 10 servers, you'll provision 11-12 servers for safety.</span>
                            </div>
                        </div>
                        <input type="number" id="peak_buffer_percentage" value="0.15" min="0" max="1" step="0.01">
                    </div>

                    <div class="form-group">
                        <div class="label-with-tooltip">
                            <label>Storage Required (GB)</label>
                            <div class="tooltip">
                                <span class="tooltip-icon">?</span>
                                <span class="tooltiptext">How much storage you need for game assets, user data, etc. This adds a fixed monthly cost regardless of user count.</span>
                            </div>
                        </div>
                        <input type="number" id="storage_gb_required" value="100" min="0">
                    </div>

                    <div class="form-group">
                        <div class="label-with-tooltip">
                            <label>Storage Cost per GB/Month ($)</label>
                            <div class="tooltip">
                                <span class="tooltip-icon">?</span>
                                <span class="tooltiptext">How much you pay per GB of storage per month. AWS S3 is typically $0.023-0.03/GB/month depending on usage.</span>
                            </div>
                        </div>
                        <input type="number" id="storage_cost_per_gb_month" value="0.03" min="0" step="0.001">
                    </div>
                </div>

                <button class="calculate-btn" onclick="calculateResults()">
                    🚀 Calculate Infrastructure Costs
                </button>
            </div>

            <!-- Results Panel -->
            <div class="results-panel">
                <div class="section">
                    <div class="results-header">
                        <h3>📊 Infrastructure Cost Results</h3>
                        <div class="label-with-tooltip">
                            <div class="tooltip cost-analysis-tooltip">
                                <span class="tooltip-icon">💡</span>
                                <span class="tooltiptext cost-analysis-text">
                                    <strong>🎯 Why Cost Per User ≈ $1.00 (gen4n_mid)</strong><br><br>

                                    <strong>Target Economics (Months 4-8):</strong><br>
                                    • 4K-8K users → 320-640 concurrent streams<br>
                                    • gen4n_mid: 6 streams/server at $0.77/hour<br>
                                    • Child model: 8% concurrent (realistic for ages 1.5-5)<br><br>

                                    <strong>Daily Usage Peaks (EST Times):</strong><br>
                                    • Bedtime routine: 6:30-8 PM EST (45% peak usage)<br>
                                    • Post-nap energy: 3-5 PM EST (35% peak usage)<br>
                                    • Nap time: 1-3 PM EST (3% usage - cost savings)<br>
                                    <em>Note: Times convert to local zones automatically (6 PM EST = 3 PM PST)</em><br><br>

                                    <strong>Cost Evolution:</strong><br>
                                    • Month 1-3: $1.15-1.30/user (launch overhead)<br>
                                    • Month 4-8: $0.90-1.00/user (optimal scale)<br>
                                    • Month 9-12: $0.90-0.95/user (mature efficiency)<br><br>

                                    <strong>Key Factors:</strong><br>
                                    • Fixed storage ($3/month) amortized across users<br>
                                    • Child behavioral patterns reduce peak hours<br>
                                    • T4 GPU efficiency for 6 concurrent streams<br>
                                    • Seasonal scaling matches family patterns
                                </span>
                            </div>
                        </div>
                    </div>
                    <div class="month-tabs" id="month_tabs"></div>
                    <div id="results_content">
                        <div class="loading">
                            Click "Calculate Infrastructure Costs" to see your server capacity needs and costs
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Handle child model toggle
        function toggleChildModel() {
            const childModelEnabled = document.getElementById('child_model_enabled').value === 'true';
            const timezoneSection = document.getElementById('timezone_distribution_section');

            // Show/hide timezone section based on child model
            if (timezoneSection) {
                timezoneSection.style.display = childModelEnabled ? 'block' : 'none';
            }

            // Auto-save settings when child model toggle changes
            if (typeof autoSaveConfig === 'function') {
                autoSaveConfig();
            }
        }

        // Validate timezone percentages sum to 1.00
        function validateTimezoneDistribution() {
            const eastern = parseFloat(document.getElementById('timezone_eastern').value) || 0;
            const central = parseFloat(document.getElementById('timezone_central').value) || 0;
            const mountain = parseFloat(document.getElementById('timezone_mountain').value) || 0;
            const pacific = parseFloat(document.getElementById('timezone_pacific').value) || 0;

            const total = eastern + central + mountain + pacific;
            const totalDisplay = document.getElementById('timezone_total_value');
            const warning = document.getElementById('timezone_warning');

            if (totalDisplay) {
                totalDisplay.textContent = total.toFixed(2);
            }

            if (warning) {
                const isValid = Math.abs(total - 1.0) < 0.01; // Allow small floating point errors
                warning.style.display = isValid ? 'none' : 'block';

                // Update input styling
                const inputs = ['timezone_eastern', 'timezone_central', 'timezone_mountain', 'timezone_pacific'];
                inputs.forEach(id => {
                    const input = document.getElementById(id);
                    if (input) {
                        input.style.borderColor = isValid ? '' : '#ff4444';
                    }
                });
            }

            return Math.abs(total - 1.0) < 0.01;
        }

        // Handle timezone input changes
        function handleTimezoneChange() {
            validateTimezoneDistribution();

            // Auto-save settings when timezone values change
            if (typeof autoSaveConfig === 'function') {
                autoSaveConfig();
            }
        }

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            // Set up event listener for child model toggle
            const childModelSelect = document.getElementById('child_model_enabled');
            if (childModelSelect) {
                childModelSelect.addEventListener('change', toggleChildModel);

                // Initialize timezone section visibility
                toggleChildModel();
            }

            // Set up timezone input listeners
            const timezoneInputs = ['timezone_eastern', 'timezone_central', 'timezone_mountain', 'timezone_pacific'];
            timezoneInputs.forEach(id => {
                const input = document.getElementById(id);
                if (input) {
                    input.addEventListener('input', handleTimezoneChange);
                    input.addEventListener('change', handleTimezoneChange);
                }
            });

            // Initialize timezone validation
            validateTimezoneDistribution();

            // Auto-save initial settings
            if (typeof autoSaveConfig === 'function') {
                autoSaveConfig();
            }
        });
    </script>
    <script src="calculator.js"></script>
</body>
</html>
